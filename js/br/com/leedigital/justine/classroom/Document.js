import ContentPanel from"../../../../../ContentPanel.js";import Page from"./Page.js";import{UTIL}from"./util/Util.js";export default class Document{constructor(arrayBuffer,contentPanel){this.contentPanel=null,this.title="",this.scrollTop=0,this.pages=[],Object.defineProperties(this,{contentPanel:{get:()=>contentPanel}}),this.init(arrayBuffer,contentPanel),window.addEventListener("keydown",evt=>{if(evt.ctrlKey){evt.preventDefault(),evt.stopImmediatePropagation();const currentPage=this.currentPage,s=83,keyCode=evt.keyCode;if(evt.shiftKey)s===keyCode&&this.saveAll();else if(currentPage){const z=90,y=89;switch(keyCode){case z:currentPage.undo();break;case y:currentPage.redo();break;case s:this.save()}}}})}init(arrayBuffer,contentPanel){}get headerElement(){return this.contentPanel.headerElement}get contentElement(){return this.contentPanel.contentElement}get innerContentElementPanel(){return this.contentElement.firstElementChild}get pageStartElement(){return this.contentPanel.pageStartElement}get pageHeight(){const element=this.innerContentElementPanel;return Math.floor(element.scrollHeight/this.pages.length)}get currentPage(){const index=this.contentPanel.pageStartElement.value-1;return index>=0&&index<this.pages.length?this.pages[index]:null}update(){}pageManager(element=null){if(this.contentPanel.pageEndElement.textContent=this.pages.length,this.pageStartElement.value=1,element){const pageHeight=this.pageHeight,scroll=element.scrollTop,currentPage=Math.floor(scroll/pageHeight),pageNumber=currentPage+1,tmp=this.pageStartElement.valueAsNumber;tmp!==pageNumber&&(this.contentPanel.pageStartElement.value=pageNumber)}}changePage(number){number>=0&&number<this.pages.length?this.pages[number].focus():(UTIL.alert("Número de página inválido "),this.pageManager(this.contentElement))}get isHandEdit(){return this.contentPanel.handEditElement.checked}get isArrowEdit(){return this.contentPanel.arrowEditElement.checked}get isLineEdit(){return this.contentPanel.lineEditElement.checked}get isDashedLineEdit(){return this.contentPanel.dashedLineEditElement.checked}get lineWidth(){return this.contentPanel.lineWidthSliderElement.valueAsNumber}get currentColor(){return this.contentPanel.currentColor}get eraser(){return this.contentPanel.eraser}get eraserLength(){return this.contentPanel.eraserSliderElement.valueAsNumber}get opacityColorValue(){return this.contentPanel.opacityColorValue}clear(){const page=this.currentPage;page&&(page.clear(),page.clearCache())}save(){const currentPage=this.currentPage;currentPage.save(),UTIL.showStatusBar("Página atual foi salva com sucesso"),console.log("saved current page")}saveAll(){const pages=this.pages;for(const page of pages)page.save();UTIL.showStatusBar("Todas as páginas foram salvas com sucesso"),console.log("saved all pages")}}