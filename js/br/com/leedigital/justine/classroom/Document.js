import ContentPanel from"../../../../../ContentPanel.js";import Page from"./Page.js";import{UTIL}from"./util/Util.js";const _documentControl=[];export default class Document{static get documentControl(){return _documentControl}static get currentDocument(){return Document.documentControl[Document.documentControl.length-1]??null}constructor(e,t){Document.documentControl.push(this),this.contentPanel=null,this.title="",this.scrollTop=0,this.pages=[],Object.defineProperties(this,{contentPanel:{get:()=>t}}),this.init(e,t),window.addEventListener("keydown",(e=>{if(e.ctrlKey){if(this!==Document.currentDocument)return;e.preventDefault(),e.stopImmediatePropagation();const t=this.currentPage,n=83,s=39,a=37,r=e.keyCode;if(e.shiftKey)n===r&&this.saveAll();else if(t){switch(r){case 90:t.undo();break;case 89:t.redo();break;case n:this.save();break;case 44:t.screenshot.capture();break;case s:this.changePage(t.number);break;case a:this.changePage(t.number-2);break}}}}))}init(e,t){}get headerElement(){return this.contentPanel.headerElement}get contentElement(){return this.contentPanel.contentElement}get innerContentElementPanel(){return this.contentElement.firstElementChild}get pageStartElement(){return this.contentPanel.pageStartElement}get pageHeight(){const e=this.innerContentElementPanel;return Math.floor(e.scrollHeight/this.pages.length)}get currentPage(){const e=this.contentPanel.pageStartElement.valueAsNumber-1;return e>=0&&e<this.pages.length?this.pages[e]:null}update(){const e=this.contentPanel.zoom;for(const t of this.pages){t.scale=e;const n=t.context2d.canvas,s=t.context2dLayer.canvas;n.style.width=s.style.width=n.width*e+"px"}}pageManager(e=null){if(this.contentPanel.pageEndElement.textContent=this.pages.length,e){const t=e.scrollTop,n=Math.floor(t/this.pageHeight)+1,s=this.pageHeight*n-this.contentElement.offsetHeight;this.pageStartElement.valueAsNumber=n;const a=this.pages.length,r=n-2,o=n-1,i=n;r>=0&&r<a&&t>this.pageHeight*r&&this.pages[r].hidden(),o>=0&&o<a&&this.pages[o].show(),e.scrollTop>s?i>=0&&i<a&&this.pages[i].show():i>0&&i<a&&this.pages[i].hidden()}}changePage(e){e>=0&&e<this.pages.length?this.pages[e].focus():(UTIL.alert("Número de página inválido "),this.pageManager(this.contentElement))}get isHandEdit(){return this.contentPanel.handEditElement.checked}get isArrowEdit(){return this.contentPanel.arrowEditElement.checked}get isLineEdit(){return this.contentPanel.lineEditElement.checked}get isDashedLineEdit(){return this.contentPanel.dashedLineEditElement.checked}get lineWidth(){return this.contentPanel.lineWidthSliderElement.valueAsNumber}get currentColor(){return this.contentPanel.currentColor}get eraser(){return this.contentPanel.eraser}get eraserLength(){return this.contentPanel.eraserSliderElement.valueAsNumber}get opacityColorValue(){return this.contentPanel.opacityColorValue}clear(){const e=this.currentPage;e&&(e.clear(),e.clearCache())}save(){this.currentPage.save(),UTIL.showStatusBar("Página atual foi salva com sucesso")}saveAll(){const e=this.pages;for(const t of e)t.save();UTIL.showStatusBar("Todas as páginas foram salvas com sucesso")}}